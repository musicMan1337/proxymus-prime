<!DOCTYPE html>
<html>

<head>
    <title>Proxy Logs Dashboard</title>
    <style>
        body {
            font-family: monospace;
            margin: 20px;
            background: #1e1e1e;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .log-section {
            margin: 20px 0;
            border: 1px solid #444;
            border-radius: 5px;
        }

        .log-header {
            background: #333;
            padding: 10px;
            font-weight: bold;
        }

        .log-content {
            height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: #2d2d2d;
        }

        .log-line {
            margin: 2px 0;
            font-size: 12px;
        }

        .error {
            color: #ff6b6b;
        }

        .warn {
            color: #feca57;
        }

        .info {
            color: #48dbfb;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            background: #0984e3;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Proxy Logs Dashboard</h1>
        <button onclick="refreshLogs()">Refresh</button>
        <button onclick="toggleAutoRefresh()">Auto Refresh: OFF</button>

        <div class="log-section">
            <div class="log-header">NGINX Access Logs</div>
            <div class="log-content" id="nginx-access"></div>
        </div>

        <div class="log-section">
            <div class="log-header">NGINX Error Logs</div>
            <div class="log-content" id="nginx-error"></div>
        </div>

        <div class="log-section">
            <div class="log-header">Redis Logs</div>
            <div class="log-content" id="redis-logs"></div>
        </div>
    </div>

    <script>
        let autoRefresh = true; // Changed from false
        let refreshInterval;

        async function fetchLogs(service, logType = '') {
            try {
                const response = await fetch(`/api/logs/${service}${logType ? '/' + logType : ''}`);
                return await response.text();
            } catch (error) {
                return `Error fetching logs: ${error.message}`;
            }
        }

        async function refreshLogs() {
            document.getElementById('nginx-access').innerHTML = await fetchLogs('nginx', 'access');
            document.getElementById('nginx-error').innerHTML = await fetchLogs('nginx', 'error');
            document.getElementById('redis-logs').innerHTML = await fetchLogs('redis');
        }

        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const button = document.querySelector('button:nth-of-type(2)');
            button.textContent = `Auto Refresh: ${autoRefresh ? 'ON' : 'OFF'}`;

            if (autoRefresh) {
                refreshInterval = setInterval(refreshLogs, 2000);
            } else {
                clearInterval(refreshInterval);
            }
        }

        // Initial load and start auto-refresh
        refreshLogs();
        toggleAutoRefresh(); // This will start auto-refresh immediately
    </script>
</body>

</html>